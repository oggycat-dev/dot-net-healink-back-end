# ==============================================
# HEALINK MICROSERVICES - ENVIRONMENT TEMPLATE
# ==============================================
# Copy this file to .env and update with your actual values

# === APPLICATION INFO ===
APP_NAME=Healink
SUPPORT_EMAIL=your_support_email@gmail.com

# === DATABASE SETTINGS ===
DB_USER=your_db_user
DB_PASSWORD=your_db_password
DB_HOST=postgres
DB_PORT=5432

# Service-specific databases  
AUTH_DB_NAME=authservicedb
USER_DB_NAME=userservicedb
CONTENT_DB_NAME=contentservicedb
SUBSCRIPTION_DB_NAME=subscriptiondb
PAYMENT_DB_NAME=paymentdb

# Generated connection strings (used by docker-compose)
AUTH_DB_CONNECTION_STRING=Host=postgres;Database=authservicedb;Username=your_db_user;Password=your_db_password
USER_DB_CONNECTION_STRING=Host=postgres;Database=userservicedb;Username=your_db_user;Password=your_db_password
CONTENT_DB_CONNECTION_STRING=Host=postgres;Database=contentservicedb;Username=your_db_user;Password=your_db_password
SUBSCRIPTION_DB_CONNECTION_STRING=Host=postgres;Database=subscriptiondb;Username=your_db_user;Password=your_db_password
PAYMENT_DB_CONNECTION_STRING=Host=postgres;Database=paymentdb;Username=your_db_user;Password=your_db_password
PODCAST_RECOMMENDATION_SERVICE_URL=http://podcastrecommendation-api
PODCAST_AI_SERVICE_URL=http://podcast-ai-service:8000

# Database configuration
DB_RETRY_ON_FAILURE=true
DB_MAX_RETRY_COUNT=3
DB_MAX_RETRY_DELAY=30

# === JWT SETTINGS ===
JWT_SECRET_KEY=your_jwt_secret_key_must_be_at_least_32_characters_long
JWT_ISSUER=Healink
JWT_AUDIENCE=Healink.Users
JWT_EXPIRES_IN_MINUTES=60
JWT_REFRESH_TOKEN_EXPIRES_IN_DAYS=7
JWT_VALIDATE_ISSUER=true
JWT_VALIDATE_AUDIENCE=true
JWT_VALIDATE_LIFETIME=true
JWT_VALIDATE_ISSUER_SIGNING_KEY=true
JWT_CLOCK_SKEW_MINUTES=5

# === RABBITMQ SETTINGS ===
RABBITMQ_HOST=rabbitmq
RABBITMQ_PORT=5672
RABBITMQ_USER=your_rabbitmq_user
RABBITMQ_PASSWORD=your_rabbitmq_password
RABBITMQ_VHOST=/
RABBITMQ_EXCHANGE=healink_exchange

# Queue names (service-specific)
AUTH_QUEUE_NAME=authservice_queue
USER_QUEUE_NAME=userservice_queue
NOTIFICATION_QUEUE_NAME=
CONTENT_QUEUE_NAME=contentservice_queue
SUBSCRIPTION_QUEUE_NAME=subscriptionservice_queue
PAYMENT_QUEUE_NAME=paymentservice_queue

# RabbitMQ additional settings
RABBITMQ_DURABLE=true
RABBITMQ_AUTO_DELETE=false
RABBITMQ_RETRY_COUNT=3
RABBITMQ_RETRY_DELAY_SECONDS=5

# === REDIS SETTINGS ===
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password
REDIS_CONNECTION_STRING=redis:6379,password=your_redis_password
REDIS_DATABASE=0
REDIS_CONNECT_TIMEOUT=5000
REDIS_SYNC_TIMEOUT=5000
REDIS_ABORT_ON_CONNECT_FAIL=false
REDIS_CONNECT_RETRY=3
REDIS_INSTANCE_NAME=HealinkMicroservices
REDIS_ENABLED=true
REDIS_DEFAULT_EXPIRATION_MINUTES=60
REDIS_USER_STATE_CACHE_MINUTES=120
REDIS_ACTIVE_USERS_LIST_HOURS=24
REDIS_USER_STATE_SLIDING_MINUTES=30

# === CORS SETTINGS ===
CORS_POLICY_NAME=DefaultCors
CORS_ALLOW_ANY_ORIGIN=false
CORS_ALLOW_ANY_METHOD=true
CORS_ALLOW_ANY_HEADER=true
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3001,http://localhost:5173,http://localhost:4200
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=*
CORS_EXPOSED_HEADERS=Content-Disposition,Token-Expired
CORS_PREFLIGHT_MAX_AGE_SECONDS=600

# === EMAIL SETTINGS (Notification Service) ===
EMAIL_SMTP_SERVER=smtp.gmail.com
EMAIL_SMTP_PORT=587
EMAIL_SENDER_EMAIL=your_email@gmail.com
EMAIL_SENDER_NAME=No Reply - Healink
EMAIL_SENDER_PASSWORD=your_app_password
EMAIL_ENABLE_SSL=true

# === FIREBASE SETTINGS (Notification Service) ===
FIREBASE_SERVER_KEY=your_firebase_server_key
FIREBASE_SENDER_ID=your_firebase_sender_id

# === ADMIN ACCOUNT ===
ADMIN_EMAIL=admin@yourdomain.com
ADMIN_PASSWORD=your_admin_password
ADMIN_USER_ID=00000000-0000-0000-0000-000000000001

# === SECURITY ===
PASSWORD_ENCRYPTION_KEY=your_password_encryption_key_32_characters

# === CACHE SETTINGS ===
CACHE_USER_STATE_CACHE_MINUTES=30
CACHE_USER_STATE_SLIDING_MINUTES=15
CACHE_ACTIVE_USERS_LIST_HOURS=24
CACHE_CLEANUP_INTERVAL_MINUTES=60
CACHE_MAX_CACHE_SIZE=10000

# === OUTBOX PROCESSOR ===
OUTBOX_PROCESSING_INTERVAL_SECONDS=30
OUTBOX_BATCH_SIZE=50
OUTBOX_MAX_RETRY_ATTEMPTS=5
OUTBOX_ENABLED=true
OUTBOX_PROCESSING_TIMEOUT_SECONDS=300
OUTBOX_ENABLE_RETRY_WITH_BACKOFF=true

# === DATA CONFIG ===
DATA_ENABLE_SEEDING=true
DATA_ENABLE_AUTO_APPLY_MIGRATIONS=true

# === OTP SETTINGS ===
OTP_LENGTH=6
OTP_EXPIRATION_MINUTES=5
OTP_MAX_ATTEMPTS=3

# OTP Rate Limiting - Registration
OTP_RATE_LIMIT_REGISTRATION_WINDOW_MINUTES=10
OTP_RATE_LIMIT_REGISTRATION_MAX_REQUESTS=3
OTP_RATE_LIMIT_REGISTRATION_COOLDOWN_SECONDS=60
OTP_RATE_LIMIT_REGISTRATION_BLOCK_DURATION_MINUTES=15

# OTP Rate Limiting - Password Reset
OTP_RATE_LIMIT_PASSWORD_RESET_WINDOW_MINUTES=10
OTP_RATE_LIMIT_PASSWORD_RESET_MAX_REQUESTS=5
OTP_RATE_LIMIT_PASSWORD_RESET_COOLDOWN_SECONDS=60
OTP_RATE_LIMIT_PASSWORD_RESET_BLOCK_DURATION_MINUTES=30

# === SERVICE URLS (Gateway) ===
AUTH_SERVICE_URL=http://authservice-api
USER_SERVICE_URL=http://userservice-api
CONTENT_SERVICE_URL=http://contentservice-api
SUBSCRIPTION_SERVICE_URL=http://subscription-api
PAYMENT_SERVICE_URL=http://payment-api
PODCAST_RECOMMENDATION_SERVICE_URL=http://podcastrecommendation-api
PODCAST_AI_SERVICE_URL=http://podcast-ai-service:8000

# === PODCAST RECOMMENDATION SERVICE SETTINGS ===
RECOMMENDATION_AI_SERVICE_BASE_URL=http://podcast-ai-service:8000
RECOMMENDATION_AI_SERVICE_TIMEOUT_SECONDS=30
RECOMMENDATION_CONTENT_SERVICE_URL=http://contentservice-api
RECOMMENDATION_USER_SERVICE_URL=http://userservice-api
RECOMMENDATION_DEFAULT_LIMIT=10
RECOMMENDATION_MAX_LIMIT=50
RECOMMENDATION_CACHE_EXPIRATION_MINUTES=60
RECOMMENDATION_ENABLE_CACHING=true

# FastAPI Service Settings (Python)
PYTHON_UNBUFFERED=1
MODEL_PATH=/app/models
MODEL_RELOAD_ON_STARTUP=false

# === SUBSCRIPTION SERVICE SETTINGS ===
SUBSCRIPTION_DEFAULT_FREE_PLAN_NAME=Free
SUBSCRIPTION_DEFAULT_FREE_PLAN_AMOUNT=0
SUBSCRIPTION_DEFAULT_FREE_PLAN_CURRENCY=VND
SUBSCRIPTION_DEFAULT_TRIAL_DAYS=7
SUBSCRIPTION_ENABLE_AUTO_RENEWAL=true
SUBSCRIPTION_GRACE_PERIOD_DAYS=3

# === PAYMENT SERVICE SETTINGS ===
PAYMENT_SUPPORTED_CURRENCIES=USD,EUR,VND
PAYMENT_DEFAULT_CURRENCY=VND
PAYMENT_INVOICE_VALIDITY_DAYS=30
PAYMENT_AUTO_CANCEL_FAILED_PAYMENT_HOURS=24
PAYMENT_ENABLE_REFUNDS=true
PAYMENT_MAX_REFUND_DAYS=30

# === MOMO GATEWAY SETTINGS ===
# MoMo API Credentials
MOMO_PARTNER_CODE=your_momo_partner_code
MOMO_PARTNER_NAME=YourBusinessName
MOMO_STORE_ID=YourStoreId
MOMO_ACCESS_KEY=your_momo_access_key
MOMO_SECRET_KEY=your_momo_secret_key
MOMO_API_ENDPOINT=https://test-payment.momo.vn/v2/gateway/api
MOMO_IPN_URL=https://your-domain.com/api/payment-callback/momo/ipn
MOMO_REDIRECT_URL=https://your-domain.com/payment/result

# MoMo IPN IP Whitelist (comma-separated IPs or CIDR ranges)
# MoMo uses multiple IPs in the same subnet: 118.69.208.0 to 118.69.223.255
# CIDR 118.69.208.0/20 covers all IPs: 118.69.208.0 - 118.69.223.255
# This includes: 118.69.210.244, 118.69.212.158, etc.
# Sandbox: 210.245.113.71
# Format: IP1,IP2,CIDR/mask
MOMO_IPN_WHITELIST=118.69.208.0/20,210.245.113.71,127.0.0.1,::1

# === CONTENT SERVICE SETTINGS ===
# AWS S3 Configuration
AWS_S3_BUCKET_NAME=healink-content-bucket
AWS_S3_REGION=us-east-1
AWS_S3_ACCESS_KEY=your_aws_access_key
AWS_S3_SECRET_KEY=your_aws_secret_key
AWS_S3_CLOUDFRONT_URL=
AWS_S3_ENABLE_ENCRYPTION=true                    # Bật mã hóa file trên S3
AWS_S3_DEFAULT_ACL=public-read                   # Quyền truy cập mặc định (public-read hoặc private)
AWS_S3_MAX_FILE_SIZE_BYTES=104857600            # 100MB (tính bằng bytes)
AWS_S3_ALLOWED_EXTENSIONS=.jpg,.jpeg,.png,.webp,.mp3,.wav,.m4a,.aac,.pdf,.txt,.docx,.doc
AWS_S3_FORCE_PATH_STYLE=false                   # Sử dụng virtual hosted-style URLs
AWS_S3_USE_HTTP=false                           # Sử dụng HTTPS (nên để false = dùng HTTPS)
AWS_S3_PRESIGNED_URL_EXPIRATION_MINUTES=60     # Thời gian hết hạn của presigned URL

# Content Settings
CONTENT_MAX_FILE_SIZE_MB=100
CONTENT_ALLOWED_FILE_TYPES=jpg,jpeg,png,gif,mp4,mp3,wav,pdf,doc,docx
CONTENT_STORAGE_PATH=/app/content

# === LOGGING CONFIGURATION ===
LOG_ENABLE_FILE_LOGGING=true
LOG_ENABLE_CONSOLE_LOGGING=true
LOG_ENABLE_DISTRIBUTED_TRACING=true
LOG_MINIMUM_LEVEL=Information
LOG_FILE_SIZE_LIMIT_MB=10
LOG_RETAINED_FILE_COUNT=30

# Docker-specific logging controls
LOG_DOCKER_REDUCE_EF_CORE_NOISE=true

# Specific category controls (set to true to enable detailed logs for debugging)
LOG_ENABLE_EF_COMMANDS=false
LOG_ENABLE_EF_CORE=false
LOG_ENABLE_NPGSQL=false
LOG_ENABLE_SQL_CLIENT=false
LOG_ENABLE_STATIC_FILES=false
LOG_ENABLE_HOSTING_DIAGNOSTICS=false
LOG_ENABLE_MVC_INFRASTRUCTURE=false
LOG_ENABLE_ROUTING=false
LOG_ENABLE_AUTHENTICATION=false
LOG_ENABLE_AUTHORIZATION=false
LOG_ENABLE_OCELOT=false
LOG_ENABLE_MASS_TRANSIT=false

# EF Core log level control (None = completely disable)
LOG_EF_CORE_LEVEL=None
LOG_EF_DATABASE_COMMAND_LEVEL=None
LOG_NPGSQL_LEVEL=None
LOG_SQL_CLIENT_LEVEL=None
